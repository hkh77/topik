from telegram import Update, ReplyKeyboardMarkup
from telegram.ext import (
    ApplicationBuilder,
    CommandHandler,
    MessageHandler,
    ContextTypes,
    filters
)

# ğŸ”‘ TOKEN
TOKEN = â€œ8577776496:AAG7dcl5ycP4rZdga8eDzYFRRK297Ft6huo
"


# ===== QUIZ SAVOLLAR =====
quiz_questions = [
    {
        "question": "í•œêµ­ì–´ì˜ ëœ»ì€ ë¬´ì—‡ì…ë‹ˆê¹Œ?\n\ní•™ìƒ",
        "options": ["Oâ€˜qituvchi", "Talaba", "Kitob", "Maktab"],
        "answer": "Talaba",
        "explain": "í•™ìƒ = talaba\ní•™(taâ€™lim) + ìƒ(shaxs)"
    },
    {
        "question": "ë¨¹ë‹¤ soâ€˜zining maâ€™nosi nima?",
        "options": ["Ichmoq", "Yemoq", "Borimoq", "Kelmoq"],
        "answer": "Yemoq",
        "explain": "ë¨¹ë‹¤ = yemoq (feâ€™l)"
    }
]


# ===== /start =====
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    context.user_data.clear()

    keyboard = [
        ["ğŸ§  Quiz oâ€˜yin"],
        ["ğŸ“˜ TOPIK Testlar"],
        ["ğŸ“— Grammatika", "ğŸ“š Lugâ€˜at"],
        ["ğŸ¥ Video darslar"],
        ["â„¹ï¸ Yordam"]
    ]

    reply_markup = ReplyKeyboardMarkup(keyboard, resize_keyboard=True)

    await update.message.reply_text(
        "ğŸ‡°ğŸ‡· Koreys tilini mukammal oâ€˜rganish botiga xush kelibsiz!\n\n"
        "ğŸ“Œ TOPIK 1â€“6 testlar\n"
        "ğŸ“Œ Grammatika tushuntirishlari\n"
        "ğŸ“Œ Lugâ€˜at va misollar\n"
        "ğŸ§  Quiz oâ€˜yin\n\n"
        "Quyidan boâ€˜lim tanlang ğŸ‘‡",
        reply_markup=reply_markup
    )


# ===== SAVOL YUBORISH =====
async def send_question(update, context):
    index = context.user_data["q_index"]
    q = quiz_questions[index]

    keyboard = [[opt] for opt in q["options"]]
    reply_markup = ReplyKeyboardMarkup(keyboard, resize_keyboard=True)

    await update.message.reply_text(
        f"â“ Savol {index + 1}\n\n{q['question']}",
        reply_markup=reply_markup
    )


# ===== XABARLARNI USHLASH =====
async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    text = update.message.text

    # QUIZ BOSHLASH
    if text == "ğŸ§  Quiz oâ€˜yin":
        context.user_data["q_index"] = 0
        await send_question(update, context)
        return

    # QUIZ DAVOMI
    if "q_index" in context.user_data:
        index = context.user_data["q_index"]
        q = quiz_questions[index]

        if text == q["answer"]:
            await update.message.reply_text(
                f"âœ… Toâ€˜gâ€˜ri!\n\nğŸ“˜ Izoh:\n{q['explain']}"
            )
        else:
            await update.message.reply_text(
                f"âŒ Notoâ€˜gâ€˜ri\n\n"
                f"âœ… Toâ€˜gâ€˜ri javob: {q['answer']}\n\n"
                f"ğŸ“˜ Izoh:\n{q['explain']}"
            )

        context.user_data["q_index"] += 1

        if context.user_data["q_index"] < len(quiz_questions):
            await send_question(update, context)
        else:
            await update.message.reply_text(
                "ğŸ‰ Quiz tugadi!\n\n/start bosib yana boshlashingiz mumkin âœ…"
            )
            context.user_data.clear()
        return

    # ===== BOSHQA BOâ€˜LIMLAR =====
    if text == "ğŸ“˜ TOPIK Testlar":
        await update.message.reply_text("ğŸ“˜ TOPIK Testlar tez orada qoâ€˜shiladi ğŸ”§")

    elif text == "ğŸ“— Grammatika":
        await update.message.reply_text("ğŸ“— Grammatika tez orada qoâ€˜shiladi ğŸ“˜")

    elif text == "ğŸ“š Lugâ€˜at":
        await update.message.reply_text("ğŸ“š Lugâ€˜at tez orada qoâ€˜shiladi ğŸ“–")

    elif text == "ğŸ¥ Video darslar":
        await update.message.reply_text("ğŸ¥ Video darslar tez orada ğŸ¬")

    elif text == "â„¹ï¸ Yordam":
        await update.message.reply_text(
            "â„¹ï¸ Yordam\n\n"
            "ğŸ§  Quiz oâ€˜yin â€“ savollarga javob berasiz\n"
            "ğŸ“˜ TOPIK 1â€“6 â€“ testlar\n"
            "ğŸ“— Grammatika va ğŸ“š Lugâ€˜at mavjud boâ€˜ladi"
        )

    else:
        await update.message.reply_text("Menyudan tanlang ğŸ‘‡")


# ===== MAIN =====
def main():
    app = ApplicationBuilder().token(TOKEN).build()

    app.add_handler(CommandHandler("start", start))
    app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))

    print("Bot ishga tushdi...")
    app.run_polling()


if name == "__main__":
    main()
